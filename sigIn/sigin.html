<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscrição</title>
    <link rel="stylesheet" href="sigin.css">
</head>
<body>

    <div id="central-block">
        <h1>VAMOS CADASTRAR SEU PERFIL?</h1>

        <form action="#" id="form-div">

            <div class="input-group">
                <div class="input-box">
                    <label for="firstname">INSIRA UM NOME E SOBRENOME:</label>
                    <input id="nome" type="text"  required>
                </div>

                <div class="input-box">
                    <label >INSIRA SEU CEP:</label>
                    <input id="cep" type="text" required>
                </div>
                <div class="input-box">
                    <label >UF:</label>
                    <input id="uf" type="text" required>
                </div>

                <div class="input-box">
                    <label>INSIRA UM USUÁRIO</label>
                    <input id="username" type="text"  required>
                </div>

                <div class="input-box">
                    <label>INSIRA SUA RUA:</label>
                    <input id="rua" type="text" required>
                </div>

                <div class="input-box">
                    <label>CIDADE:</label>
                    <input id="cidade" type="text"  required>
                </div>

                <div class="input-box">
                    <label>INSIRA UMA SENHA:</label>
                    <input id="senha" type="text"   required>
                </div>
                <div class="input-box">
                    <label >NÚMERO RESIDÊNCIA:</label>
                    <input id="numero" type="text"  required>
                </div>
                <div class="input-box">
                    <label>BAIRRO:</label>
                    <input id="bairro" type="text" name="password" required>
                </div>
                <div class="input-box">
                    <label >INSIRA A SENHA NOVAMENTE:</label>
                    <input id="input-passwd2" type="text" name="password"  required>
                </div>

                <div id="button-sigin"><a href=""><button id="button">CADASTRAR</button></a></div>


                <h2 class="Writting-index">JÁ TERMINOU?<span><a href="http://127.0.0.1:5500/login/login.html" class="span-sigin">ENTRAR</a></span></h2> 
            </div>
        </form>
    </div> 
    <script type="module">
        import { registerUser } from './cadastro.js'
        import {pesquisacep} from './cep.js'
        let inputs = {nome:document.getElementById('nome').value,cep:document.getElementById('cep').value,uf:document.getElementById('uf').value,username:document.getElementById('username').value,rua:document.getElementById('rua').value,cidade:document.getElementById('cidade').value,senha:document.getElementById('senha').value,numero:document.getElementById('numero').value,bairro:document.getElementById('bairro').value}
        document.querySelector('#cep').addEventListener('blur', (event)=>{
            let input = document.getElementById('cep')
            pesquisacep(input.value)
        })
        document.querySelector('#button').addEventListener('click',()=>{
            registerUser(inputs)
        })
        document.querySelector('#username').addEventListener('blur',()=>{
            fetch('https://musicapig.herokuapp.com/users/names',{
                headers:{
                'Content-Type':"application/json"
                },
                method:'POST',
                body:JSON.stringify({
                    username: document.querySelector('#username').value
                })
            }).then(response => verificaLogin(response)) 
    })
    async function verificaLogin(response){
        const { message } =  await response.json()
        const { status } = response

        if(status == 500){
            alert(`erro no servidor: ${message}`)
        }else if(status == 401){
            alert(message)  
        }else if(status == 200){
            alert (message)
        }
    }
    document.querySelector('#input-passwd2').addEventListener('blur',()=>{
        if(document.querySelector('#input-passwd2').value != document.querySelector('#senha').value){
            alert('as senhas não batem')
        }
    })
    document.querySelector('#button').addEventListener('click',()=>{
        let laranja = { 
            nome : document.querySelector('#nome').value,
            username : document.querySelector('#username').value,
            senha : document.querySelector('#senha').value,
            senha2:document.querySelector('#input-passwd2').value,
            cep : document.querySelector('#cep').value,
            rua: document.querySelector('#rua').value,
            uf :  document.querySelector('#uf').value,
            bairro:  document.querySelector('#bairro').value,
            cidade:  document.querySelector('#cidade').value
        }
        console.log(laranja);
        for(let i = 0; i < laranja.lenght; i ++){
            if(laranja[i] == ""){
                alert('tem certeza que preeencheu tudo?')
            }else{
                registerUser(laranja)
            }
        }

    })
    </script>
</body>
</html>
